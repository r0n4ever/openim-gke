# SeaweedFS 配置 - 兼容 S3 的对象存储
# SeaweedFS 是一个更简单、更快的分布式对象存储，可替代 MinIO

# 全局设置
global:
  # 创建 RBAC 资源
  rbac:
    create: true
  
  # 监控
  monitoring:
    enabled: true

# Master 服务器配置（元数据和卷管理）
master:
  enabled: true
  replicas: 3  # 用于高可用性
  
  # 资源限制
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 200m
      memory: 256Mi
  
  # 元数据持久化
  persistence:
    enabled: true
    storageClass: standard
    size: 5Gi
  
  # 服务配置
  service:
    type: ClusterIP
    port: 9333

# Volume 服务器配置（数据存储）
volume:
  enabled: true
  replicas: 3
  
  # 每个 volume 服务器的数据目录
  dataDirs:
    - name: data1
      size: 50Gi
      storageClass: standard
  
  # 资源限制
  resources:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi
  
  # 服务配置
  service:
    type: ClusterIP
    port: 8080

# Filer 配置（文件系统接口和 S3 API）
filer:
  enabled: true
  replicas: 2
  
  # 启用 S3 API
  s3:
    enabled: true
    port: 8333
    # S3 配置
    config: |
      {
        "identities": [
          {
            "name": "anonymous",
            "credentials": [
              {
                "accessKey": "admin",
                "secretKey": "admin123"
              }
            ],
            "actions": [
              "Admin",
              "Read",
              "Write"
            ]
          }
        ]
      }
  
  # 启用 WebDAV（可选）
  webdav:
    enabled: false
  
  # 资源限制
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi
  
  # Filer 元数据持久化
  persistence:
    enabled: true
    storageClass: standard
    size: 10Gi
  
  # 服务配置
  service:
    type: ClusterIP
    port: 8888

# Ingress 配置（可选，用于外部访问）
ingress:
  enabled: false
  # 取消注释并配置以实现外部访问
  # className: nginx
  # annotations:
  #   cert-manager.io/cluster-issuer: letsencrypt-prod
  # hosts:
  #   - host: s3.openim.example.com
  #     paths:
  #       - path: /
  #         pathType: Prefix
  #         service:
  #           name: seaweedfs-filer
  #           port: 8333
  # tls:
  #   - secretName: seaweedfs-tls
  #     hosts:
  #       - s3.openim.example.com

# ==============================================================================
# 安装命令：
# helm repo add seaweedfs https://seaweedfs.github.io/seaweedfs/helm
# helm repo update
# helm install seaweedfs seaweedfs/seaweedfs \
#   --namespace seaweedfs --create-namespace \
#   --values helm/40-seaweedfs/values.yaml
# ==============================================================================

# OpenIM 的 S3 连接详情：
# 端点：http://seaweedfs-filer.seaweedfs.svc.cluster.local:8333
# 访问密钥：admin
# 秘密密钥：admin123
# 区域：us-east-1（任何值都可以）

# 相比 MinIO 的优势：
# - 更简单的架构（无分布式锁定复杂性）
# - 适合大量小文件的更好性能
# - 更低的资源消耗
# - 完全兼容 S3 API（无需修改代码）
# - 原生文件系统接口（Filer）

# 权衡：
# - 生态系统比 MinIO 小
# - 企业功能较少
# - S3 兼容性较低（99% 兼容）

# 生产环境需要考虑：
# - 更改默认 S3 凭证（admin/admin123）
# - 为 S3 API 启用 TLS
# - 设置 ingress 以实现外部访问
# - 配置备份和复制
# - 根据工作负载调整存储大小
# - 考虑为大型部署添加更多 volume 服务器
