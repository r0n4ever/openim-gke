# Redpanda 配置 - 兼容 Kafka API 的消息队列
# Redpanda 是一个兼容 Kafka 的流平台，比 Kafka 更简单、更快

# 集群配置
cluster:
  # Redpanda broker 数量
  replicas: 3

# 存储配置
storage:
  persistentVolume:
    enabled: true
    size: 10Gi
    storageClass: standard  # GKE 默认存储类
  
  # 分层存储用于成本优化（可选）
  tieredStorage:
    enabled: false

# 资源限制
resources:
  cpu:
    cores: 1000m
  memory:
    container:
      max: 2Gi
      min: 1Gi

# Kafka API 配置
kafkaApi:
  - port: 9092
    authenticationMethod: none  # 用于内部集群使用

# Schema Registry（可选，对数据验证有用）
schemaRegistry:
  enabled: true
  port: 8081

# HTTP Proxy 用于 REST API
pandaproxy:
  enabled: true
  port: 8082

# 监控
monitoring:
  enabled: true
  scrapeInterval: 30s

# 高可用性亲和性规则
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - redpanda
          topologyKey: kubernetes.io/hostname

# 服务配置
service:
  type: ClusterIP  # 仅内部访问
  ports:
    kafka: 9092
    admin: 9644
    schemaRegistry: 8081
    proxy: 8082

# ==============================================================================
# 安装命令：
# helm repo add redpanda https://charts.redpanda.com
# helm repo update
# helm install redpanda redpanda/redpanda \
#   --namespace redpanda --create-namespace \
#   --values helm/20-redpanda/values.yaml
# ==============================================================================

# OpenIM 的连接详情：
# Bootstrap 服务器：redpanda.redpanda.svc.cluster.local:9092
# Schema Registry：http://redpanda.redpanda.svc.cluster.local:8081

# 相比 Kafka 的优势：
# - 单一二进制文件，无需 ZooKeeper 依赖
# - 更低的资源消耗
# - 完全兼容 Kafka API（无需修改代码）
# - 内置 schema registry
# - 适合较小集群的更好性能

# 生产环境需要考虑：
# - 启用认证（SASL/SCRAM）
# - 设置 TLS 加密
# - 配置分层存储以节省成本
# - 根据工作负载调整保留策略
